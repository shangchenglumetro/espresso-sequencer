<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>LightClient</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../../favicon.svg">
        <link rel="shortcut icon" href="../../../favicon.png">
        <link rel="stylesheet" href="../../../css/variables.css">
        <link rel="stylesheet" href="../../../css/general.css">
        <link rel="stylesheet" href="../../../css/chrome.css">
        <link rel="stylesheet" href="../../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../../highlight.css">
        <link rel="stylesheet" href="../../../tomorrow-night.css">
        <link rel="stylesheet" href="../../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../../../book.css">


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="../../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/shangchenglumetro/espresso-sequencer" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="lightclient"><a class="header" href="#lightclient">LightClient</a></h1>
<p><a href="https://github.com/shangchenglumetro/espresso-sequencer/blob/5b640c723a9b1ff8f5b03b2be264ac78cf33ced7/contracts/src/LightClient.sol">Git Source</a></p>
<p><strong>Inherits:</strong>
Initializable, OwnableUpgradeable, UUPSUpgradeable</p>
<p>This contract serves as an always-on client
that verifies HotShot's state (Espresso's consensus state) which can be used by
Rollup contracts on L1 (Ethereum).
This state is submitted by any state-prover with evidence which is
a SNARK proof that proves consensus.
This contract also keeps track of the current epoch.
For this version, the epoch is not used. <br>
The light client state primarily consists of:<br></p>
<ul>
<li>the merkle root of finalized block commitments,<br></li>
<li>the fee ledger commitment and <br></li>
<li>the active stake table commitment<br></li>
</ul>
<p><em>You can use this contract to keep track of its finalized states in safe,
authenticated ways.</em></p>
<h2 id="state-variables"><a class="header" href="#state-variables">State Variables</a></h2>
<h3 id="genesisstaketablestate"><a class="header" href="#genesisstaketablestate">genesisStakeTableState</a></h3>
<p>genesis stake commitment</p>
<pre><code class="language-solidity">StakeTableState public genesisStakeTableState;
</code></pre>
<h3 id="genesisstate"><a class="header" href="#genesisstate">genesisState</a></h3>
<p>genesis block commitment</p>
<pre><code class="language-solidity">LightClientState public genesisState;
</code></pre>
<h3 id="finalizedstate"><a class="header" href="#finalizedstate">finalizedState</a></h3>
<p>Finalized HotShot's light client state</p>
<pre><code class="language-solidity">LightClientState public finalizedState;
</code></pre>
<h3 id="permissionedprover"><a class="header" href="#permissionedprover">permissionedProver</a></h3>
<p>the address of the prover that can call the newFinalizedState function when the
contract is in permissioned prover mode. This address is address(0) when the contract is
not in permissioned prover mode</p>
<pre><code class="language-solidity">address public permissionedProver;
</code></pre>
<h3 id="statehistoryretentionperiod"><a class="header" href="#statehistoryretentionperiod">stateHistoryRetentionPeriod</a></h3>
<p>Max number of seconds worth of state commitments to record based on this block
timestamp</p>
<pre><code class="language-solidity">uint32 public stateHistoryRetentionPeriod;
</code></pre>
<h3 id="statehistoryfirstindex"><a class="header" href="#statehistoryfirstindex">stateHistoryFirstIndex</a></h3>
<p>index of first block in block state series</p>
<p><em>use this instead of index 0 since old states would be set to zero to keep storage costs
constant to stateHistoryRetentionPeriod</em></p>
<pre><code class="language-solidity">uint64 public stateHistoryFirstIndex;
</code></pre>
<h3 id="statehistorycommitments"><a class="header" href="#statehistorycommitments">stateHistoryCommitments</a></h3>
<p>an array to store the L1 block heights, HotShot Block Heights and their respective
state history
commitments</p>
<pre><code class="language-solidity">StateHistoryCommitment[] public stateHistoryCommitments;
</code></pre>
<h2 id="functions"><a class="header" href="#functions">Functions</a></h2>
<h3 id="constructor"><a class="header" href="#constructor">constructor</a></h3>
<p>Constructor disables initializers to prevent the implementation contract from being
initialized</p>
<p><em>This is standard practice for OpenZeppelin upgradeable contracts. Storage is on the
proxy contract
since it calls this cnotract via delegatecall</em></p>
<p><strong>Note:</strong>
oz-upgrades-unsafe-allow: constructor</p>
<pre><code class="language-solidity">constructor();
</code></pre>
<h3 id="initialize"><a class="header" href="#initialize">initialize</a></h3>
<p>This contract is called by the proxy when you deploy this contract</p>
<pre><code class="language-solidity">function initialize(
    LightClientState memory _genesis,
    StakeTableState memory _genesisStakeTableState,
    uint32 _stateHistoryRetentionPeriod,
    address owner
) public initializer;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_genesis</code></td><td><code>LightClientState</code></td><td>The initial state of the light client</td></tr>
<tr><td><code>_genesisStakeTableState</code></td><td><code>StakeTableState</code></td><td></td></tr>
<tr><td><code>_stateHistoryRetentionPeriod</code></td><td><code>uint32</code></td><td>The maximum retention period (in seconds) for the state history. the min retention period allowed is 1 hour and max 365 days</td></tr>
<tr><td><code>owner</code></td><td><code>address</code></td><td>The address of the contract owner</td></tr>
</tbody></table>
</div>
<h3 id="getversion"><a class="header" href="#getversion">getVersion</a></h3>
<p>Use this to get the implementation contract version</p>
<pre><code class="language-solidity">function getVersion()
    public
    pure
    virtual
    returns (uint8 majorVersion, uint8 minorVersion, uint8 patchVersion);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>majorVersion</code></td><td><code>uint8</code></td><td>The major version of the contract</td></tr>
<tr><td><code>minorVersion</code></td><td><code>uint8</code></td><td>The minor version of the contract</td></tr>
<tr><td><code>patchVersion</code></td><td><code>uint8</code></td><td>The patch version of the contract</td></tr>
</tbody></table>
</div>
<h3 id="_authorizeupgrade"><a class="header" href="#_authorizeupgrade">_authorizeUpgrade</a></h3>
<p>only the owner can authorize an upgrade</p>
<pre><code class="language-solidity">function _authorizeUpgrade(address newImplementation) internal virtual override onlyOwner;
</code></pre>
<h3 id="_initializestate"><a class="header" href="#_initializestate">_initializeState</a></h3>
<p><em>Initialization of contract variables happens in this method because the LightClient
contract is upgradable and thus has its constructor method disabled.</em></p>
<pre><code class="language-solidity">function _initializeState(
    LightClientState memory _genesis,
    StakeTableState memory _genesisStakeTableState,
    uint32 _stateHistoryRetentionPeriod
) internal;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_genesis</code></td><td><code>LightClientState</code></td><td>The initial state of the light client</td></tr>
<tr><td><code>_genesisStakeTableState</code></td><td><code>StakeTableState</code></td><td>The initial stake table state of the light client</td></tr>
<tr><td><code>_stateHistoryRetentionPeriod</code></td><td><code>uint32</code></td><td>The maximum retention period (in seconds) for the state history. The min retention period allowed is 1 hour and the max is 365 days.</td></tr>
</tbody></table>
</div>
<h3 id="newfinalizedstate"><a class="header" href="#newfinalizedstate">newFinalizedState</a></h3>
<p>Update the latest finalized light client state. It must be updated
periodically, especially an update for the last block for every
period has to be submitted
before any newer state can be accepted since the stake table commitments of that block
become the snapshots used for vote verifications later on.</p>
<p>While <code>newState.stakeTable*</code> refers to the (possibly) new stake table states,
the entire <code>newState</code> needs to be signed by stakers in <code>finalizedState</code></p>
<p><em>if the permissionedProver is set, only the permissionedProver can call this function</em></p>
<p><em>the state history for <code>stateHistoryRetentionPeriod</code> L1 blocks are also recorded in the
<code>stateHistoryCommitments</code> array</em></p>
<pre><code class="language-solidity">function newFinalizedState(LightClientState memory newState, IPlonkVerifier.PlonkProof memory proof)
    external
    virtual;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>newState</code></td><td><code>LightClientState</code></td><td>new light client state</td></tr>
<tr><td><code>proof</code></td><td><code>IPlonkVerifier.PlonkProof</code></td><td>PlonkProof</td></tr>
</tbody></table>
</div>
<h3 id="verifyproof"><a class="header" href="#verifyproof">verifyProof</a></h3>
<p>Verify the Plonk proof, marked as <code>virtual</code> for easier testing as we can swap VK
used in inherited contracts.</p>
<pre><code class="language-solidity">function verifyProof(LightClientState memory state, IPlonkVerifier.PlonkProof memory proof)
    internal
    virtual;
</code></pre>
<h3 id="setpermissionedprover"><a class="header" href="#setpermissionedprover">setPermissionedProver</a></h3>
<p>set the permissionedProver to the non-zero address provided</p>
<p><em>this function can also be used to update the permissioned prover once it's a different
address to the current permissioned prover</em></p>
<pre><code class="language-solidity">function setPermissionedProver(address prover) public virtual onlyOwner;
</code></pre>
<h3 id="disablepermissionedprovermode"><a class="header" href="#disablepermissionedprovermode">disablePermissionedProverMode</a></h3>
<p>set the permissionedProver to address(0)</p>
<p><em>if it was already disabled, then revert with the error, NoChangeRequired</em></p>
<pre><code class="language-solidity">function disablePermissionedProverMode() public virtual onlyOwner;
</code></pre>
<h3 id="updatestatehistory"><a class="header" href="#updatestatehistory">updateStateHistory</a></h3>
<p>Updates the <code>stateHistoryCommitments</code> array when a new finalized state is added
and prunes the most outdated element starting from the first element if they fall outside
the
<code>stateHistoryRetentionPeriod</code>.</p>
<p><em>the block timestamp is used to determine if the stateHistoryCommitments array
should be pruned, based on the stateHistoryRetentionPeriod (seconds).</em></p>
<p><em>A FIFO approach is used to remove the most outdated element from the start of the
array.
However, only one outdated element is removed per invocation of this function, even if
multiple elements exceed the retention period. As a result, some outdated elements may
remain in the array temporarily until subsequent invocations of this function.</em></p>
<p><em>the <code>delete</code> method does not reduce the array length but resets the value at the
specified index to zero. the stateHistoryFirstIndex variable acts as an offset to indicate
the starting point for reading the array, since the length of the array is not reduced
even after deletion.</em></p>
<pre><code class="language-solidity">function updateStateHistory(
    uint64 blockNumber,
    uint64 blockTimestamp,
    LightClientState memory state
) internal;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>blockNumber</code></td><td><code>uint64</code></td><td>The block number of the new finalized state.</td></tr>
<tr><td><code>blockTimestamp</code></td><td><code>uint64</code></td><td>The block timestamp used to check the retention period.</td></tr>
<tr><td><code>state</code></td><td><code>LightClientState</code></td><td>The new <code>LightClientState</code> being added to the array.</td></tr>
</tbody></table>
</div>
<h3 id="lagoverescapehatchthreshold"><a class="header" href="#lagoverescapehatchthreshold">lagOverEscapeHatchThreshold</a></h3>
<p>checks if the state updates lag behind the specified block threshold based on the
provided block number.</p>
<p><em>Reverts if there isn't enough state history to make an accurate comparison.
Reverts if the blockThreshold is zero</em></p>
<pre><code class="language-solidity">function lagOverEscapeHatchThreshold(uint256 blockNumber, uint256 blockThreshold)
    public
    view
    virtual
    returns (bool);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>blockNumber</code></td><td><code>uint256</code></td><td>The block number to compare against the latest state updates.</td></tr>
<tr><td><code>blockThreshold</code></td><td><code>uint256</code></td><td>The number of blocks updates this contract is allowed to lag behind.</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>bool returns true if the lag exceeds the blockThreshold; otherwise, false.</td></tr>
</tbody></table>
</div>
<h3 id="gethotshotcommitment"><a class="header" href="#gethotshotcommitment">getHotShotCommitment</a></h3>
<p>get the HotShot commitment that represents the Merkle root containing the leaf at
the provided hotShotBlockHeight where the block height in the array is greater than</p>
<p><em>if the provided hotShotBlockHeight is greater than the latest commitment in the array,
the function reverts.</em></p>
<pre><code class="language-solidity">function getHotShotCommitment(uint256 hotShotBlockHeight)
    public
    view
    virtual
    returns (BN254.ScalarField hotShotBlockCommRoot, uint64 hotshotBlockHeight);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>hotShotBlockHeight</code></td><td><code>uint256</code></td><td>the HotShot block height</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>hotShotBlockCommRoot</code></td><td><code>BN254.ScalarField</code></td><td>the HotShot commitment root</td></tr>
<tr><td><code>hotshotBlockHeight</code></td><td><code>uint64</code></td><td>the HotShot block height for the corresponding commitment root</td></tr>
</tbody></table>
</div>
<h3 id="getstatehistorycount"><a class="header" href="#getstatehistorycount">getStateHistoryCount</a></h3>
<p>get the number of state history commitments</p>
<pre><code class="language-solidity">function getStateHistoryCount() public view returns (uint256);
</code></pre>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>uint256</code></td><td>uint256 The number of state history commitments</td></tr>
</tbody></table>
</div>
<h3 id="setstatehistoryretentionperiod"><a class="header" href="#setstatehistoryretentionperiod">setstateHistoryRetentionPeriod</a></h3>
<p>sets the maximum retention period for storing block state history.</p>
<p><em>Reverts with <code>InvalidMaxStateHistory</code> if the provided value is less than 1 hour,
more than 365 days or less than or equal to the current state history retention period.</em></p>
<pre><code class="language-solidity">function setstateHistoryRetentionPeriod(uint32 historySeconds) public onlyOwner;
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>historySeconds</code></td><td><code>uint32</code></td><td>The maximum number of seconds for which state history updates will be stored, based on the block timestamp. It must be greater than or equal to the current state history retention period and must be at least 1 hour and max 365 days.</td></tr>
</tbody></table>
</div>
<h3 id="ispermissionedproverenabled"><a class="header" href="#ispermissionedproverenabled">isPermissionedProverEnabled</a></h3>
<p>Check if permissioned prover is enabled</p>
<pre><code class="language-solidity">function isPermissionedProverEnabled() public view returns (bool);
</code></pre>
<h2 id="events"><a class="header" href="#events">Events</a></h2>
<h3 id="upgrade"><a class="header" href="#upgrade">Upgrade</a></h3>
<p>upgrade event when the proxy updates the implementation it's pointing to</p>
<pre><code class="language-solidity">event Upgrade(address implementation);
</code></pre>
<h3 id="permissionedproverrequired"><a class="header" href="#permissionedproverrequired">PermissionedProverRequired</a></h3>
<p>when a permissioned prover is set, this event is emitted.</p>
<pre><code class="language-solidity">event PermissionedProverRequired(address permissionedProver);
</code></pre>
<h3 id="permissionedprovernotrequired"><a class="header" href="#permissionedprovernotrequired">PermissionedProverNotRequired</a></h3>
<p>when the permissioned prover is unset, this event is emitted.</p>
<pre><code class="language-solidity">event PermissionedProverNotRequired();
</code></pre>
<h3 id="newstate"><a class="header" href="#newstate">NewState</a></h3>
<p>Event that a new finalized state has been successfully verified and updated</p>
<pre><code class="language-solidity">event NewState(uint64 indexed viewNum, uint64 indexed blockHeight, BN254.ScalarField blockCommRoot);
</code></pre>
<h2 id="errors"><a class="header" href="#errors">Errors</a></h2>
<h3 id="outdatedstate"><a class="header" href="#outdatedstate">OutdatedState</a></h3>
<p>The state is outdated and older than currently known <code>finalizedState</code></p>
<pre><code class="language-solidity">error OutdatedState();
</code></pre>
<h3 id="invalidargs"><a class="header" href="#invalidargs">InvalidArgs</a></h3>
<p>Invalid user inputs: wrong format or non-sensible arguments</p>
<pre><code class="language-solidity">error InvalidArgs();
</code></pre>
<h3 id="invalidproof"><a class="header" href="#invalidproof">InvalidProof</a></h3>
<p>Wrong plonk proof or public inputs.</p>
<pre><code class="language-solidity">error InvalidProof();
</code></pre>
<h3 id="wrongstaketableused"><a class="header" href="#wrongstaketableused">WrongStakeTableUsed</a></h3>
<p>Wrong stake table used, should match <code>finalizedState</code></p>
<pre><code class="language-solidity">error WrongStakeTableUsed();
</code></pre>
<h3 id="invalidaddress"><a class="header" href="#invalidaddress">InvalidAddress</a></h3>
<p>Invalid address</p>
<pre><code class="language-solidity">error InvalidAddress();
</code></pre>
<h3 id="provernotpermissioned"><a class="header" href="#provernotpermissioned">ProverNotPermissioned</a></h3>
<p>Only a permissioned prover can perform this action</p>
<pre><code class="language-solidity">error ProverNotPermissioned();
</code></pre>
<h3 id="nochangerequired"><a class="header" href="#nochangerequired">NoChangeRequired</a></h3>
<p>If the same mode or prover is sent to the function, then no change is required</p>
<pre><code class="language-solidity">error NoChangeRequired();
</code></pre>
<h3 id="insufficientsnapshothistory"><a class="header" href="#insufficientsnapshothistory">InsufficientSnapshotHistory</a></h3>
<p>Invalid L1 Block for checking Light Client Updates, premature or in the future</p>
<pre><code class="language-solidity">error InsufficientSnapshotHistory();
</code></pre>
<h3 id="invalidhotshotblockforcommitmentcheck"><a class="header" href="#invalidhotshotblockforcommitmentcheck">InvalidHotShotBlockForCommitmentCheck</a></h3>
<p>Invalid HotShot Block for checking HotShot commitments, premature or in the future</p>
<pre><code class="language-solidity">error InvalidHotShotBlockForCommitmentCheck();
</code></pre>
<h3 id="invalidmaxstatehistory"><a class="header" href="#invalidmaxstatehistory">InvalidMaxStateHistory</a></h3>
<p>Invalid Max Block States</p>
<pre><code class="language-solidity">error InvalidMaxStateHistory();
</code></pre>
<h2 id="structs"><a class="header" href="#structs">Structs</a></h2>
<h3 id="lightclientstate"><a class="header" href="#lightclientstate">LightClientState</a></h3>
<p>The finalized HotShot state (as the digest of the entire HotShot state)</p>
<pre><code class="language-solidity">struct LightClientState {
    uint64 viewNum;
    uint64 blockHeight;
    BN254.ScalarField blockCommRoot;
}
</code></pre>
<p><strong>Properties</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>viewNum</code></td><td><code>uint64</code></td><td>The latest view number of the finalized HotShot chain</td></tr>
<tr><td><code>blockHeight</code></td><td><code>uint64</code></td><td>The block height of the latest finalized block</td></tr>
<tr><td><code>blockCommRoot</code></td><td><code>BN254.ScalarField</code></td><td>The merkle root of historical block commitments (BN254::ScalarField)</td></tr>
</tbody></table>
</div>
<h3 id="staketablestate"><a class="header" href="#staketablestate">StakeTableState</a></h3>
<p>The finalized HotShot Stake state (as the digest of the entire HotShot state)</p>
<pre><code class="language-solidity">struct StakeTableState {
    uint256 threshold;
    BN254.ScalarField blsKeyComm;
    BN254.ScalarField schnorrKeyComm;
    BN254.ScalarField amountComm;
}
</code></pre>
<p><strong>Properties</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>threshold</code></td><td><code>uint256</code></td><td>The (stake-weighted) quorum threshold for a QC to be considered as valid</td></tr>
<tr><td><code>blsKeyComm</code></td><td><code>BN254.ScalarField</code></td><td>The commitment to the BlsVerKey column of the stake table</td></tr>
<tr><td><code>schnorrKeyComm</code></td><td><code>BN254.ScalarField</code></td><td>The commitment to the SchnorrVerKey column of the table</td></tr>
<tr><td><code>amountComm</code></td><td><code>BN254.ScalarField</code></td><td>The commitment to the stake amount column of the stake table</td></tr>
</tbody></table>
</div>
<h3 id="statehistorycommitment"><a class="header" href="#statehistorycommitment">StateHistoryCommitment</a></h3>
<p>Simplified HotShot commitment struct</p>
<pre><code class="language-solidity">struct StateHistoryCommitment {
    uint64 l1BlockHeight;
    uint64 l1BlockTimestamp;
    uint64 hotShotBlockHeight;
    BN254.ScalarField hotShotBlockCommRoot;
}
</code></pre>
<p><strong>Properties</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>l1BlockHeight</code></td><td><code>uint64</code></td><td>the block height of l1 when this state update was stored</td></tr>
<tr><td><code>l1BlockTimestamp</code></td><td><code>uint64</code></td><td>the block timestamp of l1 when this state update was stored</td></tr>
<tr><td><code>hotShotBlockHeight</code></td><td><code>uint64</code></td><td>The block height of the latest finalized HotShot block</td></tr>
<tr><td><code>hotShotBlockCommRoot</code></td><td><code>BN254.ScalarField</code></td><td>The merkle root of historical block commitments (BN254::ScalarField)</td></tr>
</tbody></table>
</div>
                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../../contracts/src/FeeContract.sol/contract.FeeContract.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../../contracts/src/PermissionedStakeTable.sol/contract.PermissionedStakeTable.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../../contracts/src/FeeContract.sol/contract.FeeContract.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../../contracts/src/PermissionedStakeTable.sol/contract.PermissionedStakeTable.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../../elasticlunr.min.js"></script>
        <script src="../../../mark.min.js"></script>
        <script src="../../../searcher.js"></script>

        <script src="../../../clipboard.min.js"></script>
        <script src="../../../highlight.js"></script>
        <script src="../../../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../../../solidity.min.js"></script>


    </div>
    </body>
</html>
